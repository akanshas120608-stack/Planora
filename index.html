<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planora - Your Smart Study Planner</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/x-icon" href="https://i.ibb.co/23kTbpHJ/Whats-App-Image-2025-12-31-at-01-34-54.jpg">
</head>
<body>
    <!-- Top Header with Logo -->
    <header class="main-header">
        <div class="header-content">
            <div class="logo-container">
                <img src="https://i.ibb.co/23kTbpHJ/Whats-App-Image-2025-12-31-at-01-34-54.jpg" alt="Planora Logo" class="logo">
                <h1 class="app-title">Planora</h1>
            </div>
            <div class="user-section">
                <button class="theme-toggle" id="theme-toggle" title="Toggle Dark Mode">
                    <i class="fas fa-moon"></i>
                </button>
                <div class="login-prompt" id="login-prompt">
                    <i class="fas fa-user"></i>
                    <span>Sign in to save your data</span>
                    <button class="login-btn" id="login-btn">Sign In</button>
                </div>
                <div class="user-info hidden" id="user-info">
                    <span id="username">User</span>
                    <button class="logout-btn" id="logout-btn">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Premium Banner -->
    <div class="premium-banner">
        <div class="banner-content">
            <i class="fas fa-crown"></i>
            <span><strong>Premium</strong> launching soon! Get unlimited subjects, cloud sync, and more.</span>
            <button class="waitlist-btn" id="waitlist-btn">Join Waitlist</button>
        </div>
    </div>

    <!-- Main App Container -->
    <div class="app-container">
        <!-- Month/Year Selector -->
        <div class="month-selector">
            <button class="nav-btn" id="prev-month">
                <i class="fas fa-chevron-left"></i>
            </button>
            <div class="month-display">
                <h2 id="current-month">January 2026</h2>
                <div class="date-range" id="date-range">Jan 01 - Jan 31</div>
            </div>
            <button class="nav-btn" id="next-month">
                <i class="fas fa-chevron-right"></i>
            </button>
        </div>

        <!-- Date Grid -->
        <div class="date-grid-container">
            <div class="date-grid" id="date-grid">
                <!-- Generated by JavaScript -->
            </div>
        </div>

        <!-- Days Container -->
        <div class="days-container" id="days-container">
            <!-- Generated by JavaScript -->
        </div>

        <!-- Mobile Swipe Instructions -->
        <div class="swipe-hint mobile-only">
            <i class="fas fa-arrows-alt-h"></i>
            <span>Swipe left/right to navigate days</span>
        </div>
    </div>

    <!-- Add Task Modal -->
    <div class="modal hidden" id="add-task-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-plus-circle"></i> Add New Task</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="task-subject-select">Subject</label>
                    <select id="task-subject-select">
                        <!-- Generated by JavaScript -->
                    </select>
                </div>
                <div class="form-group">
                    <label for="task-description">Task Description</label>
                    <input type="text" id="task-description" placeholder="Enter task description..." autofocus>
                </div>
                <button class="btn-primary" id="save-task-btn">
                    <i class="fas fa-check"></i> Add Task
                </button>
            </div>
        </div>
    </div>

    <!-- Add/Edit Subject Modal -->
    <div class="modal hidden" id="subject-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-book"></i> <span id="subject-modal-title">Add Subject</span></h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="subject-name">Subject Name</label>
                    <input type="text" id="subject-name" placeholder="e.g., History, Computer Science..." autofocus>
                </div>
                <div class="form-group">
                    <label for="subject-color">Color</label>
                    <div class="color-picker">
                        <input type="color" id="subject-color" value="#4a6fa5">
                        <span id="color-preview" style="background: #4a6fa5;"></span>
                    </div>
                </div>
                <button class="btn-primary" id="save-subject-btn">
                    <i class="fas fa-check"></i> Save Subject
                </button>
            </div>
        </div>
    </div>

    <!-- Manage Subjects Modal -->
    <div class="modal hidden" id="manage-subjects-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-cog"></i> Manage Subjects</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div id="subjects-list">
                    <!-- Generated by JavaScript -->
                </div>
                <button class="btn-primary" id="add-new-subject-btn" style="margin-top: 15px;">
                    <i class="fas fa-plus"></i> Add New Subject
                </button>
            </div>
        </div>
    </div>

    <!-- Waitlist Modal -->
    <div class="modal hidden" id="waitlist-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-crown"></i> Join Premium Waitlist</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <p>Be the first to know when Planora Premium launches!</p>
                <div class="premium-features">
                    <h4>Premium Features:</h4>
                    <ul>
                        <li><i class="fas fa-check"></i> Unlimited subjects & tasks</li>
                        <li><i class="fas fa-check"></i> Cloud backup & sync</li>
                        <li><i class="fas fa-check"></i> Dark mode & themes</li>
                        <li><i class="fas fa-check"></i> PDF export & analytics</li>
                        <li><i class="fas fa-check"></i> Priority support</li>
                    </ul>
                </div>
                <div class="form-group">
                    <label for="waitlist-email">Your Email</label>
                    <input type="email" id="waitlist-email" placeholder="you@example.com">
                </div>
                <button class="btn-primary" id="join-waitlist-btn">Join Waitlist</button>
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div class="modal hidden" id="login-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-sign-in-alt"></i> Login to Planora</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="login-email">Email</label>
                    <input type="email" id="login-email" placeholder="you@example.com">
                </div>
                <div class="form-group">
                    <label for="login-password">Password</label>
                    <input type="password" id="login-password" placeholder="Enter your password">
                </div>
                <div class="form-options">
                    <a href="#" class="forgot-password" id="forgot-password">Forgot password?</a>
                </div>
                <div id="login-error" class="hidden"></div>
                <button class="btn-primary" id="login-submit-btn">
                    <i class="fas fa-spinner fa-spin hidden" id="login-spinner"></i>
                    <span id="login-text">Login</span>
                </button>
                <div class="auth-switch">
                    <p>Don't have an account? <a href="#" id="switch-to-signup">Sign up</a></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Sign Up Modal -->
    <div class="modal hidden" id="signup-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-user-plus"></i> Create Account</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="signup-email">Email</label>
                    <input type="email" id="signup-email" placeholder="you@example.com">
                </div>
                <div class="form-group">
                    <label for="signup-password">Password</label>
                    <input type="password" id="signup-password" placeholder="Create a password (min. 6 characters)">
                </div>
                <div class="form-group">
                    <label for="signup-confirm">Confirm Password</label>
                    <input type="password" id="signup-confirm" placeholder="Confirm your password">
                </div>
                <div class="password-requirements">
                    <small>Password must be at least 6 characters long</small>
                </div>
                <div id="signup-error" class="hidden"></div>
                <button class="btn-primary" id="signup-submit-btn">
                    <i class="fas fa-spinner fa-spin hidden" id="signup-spinner"></i>
                    <span id="signup-text">Create Account</span>
                </button>
                <div class="auth-switch">
                    <p>Already have an account? <a href="#" id="switch-to-login">Login</a></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Forgot Password Modal -->
    <div class="modal hidden" id="forgot-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-key"></i> Reset Password</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <p>Enter your email and we'll send you a link to reset your password.</p>
                <div class="form-group">
                    <label for="forgot-email">Email</label>
                    <input type="email" id="forgot-email" placeholder="you@example.com">
                </div>
                <div id="forgot-error" class="hidden"></div>
                <div id="forgot-success" class="hidden"></div>
                <button class="btn-primary" id="forgot-submit-btn">
                    <i class="fas fa-spinner fa-spin hidden" id="forgot-spinner"></i>
                    <span id="forgot-text">Send Reset Link</span>
                </button>
                <div class="auth-switch">
                    <p>Remember your password? <a href="#" id="switch-to-login-from-forgot">Login</a></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="main-footer">
        <div class="footer-content">
            <div class="footer-links">
                <a href="support.html" class="footer-link">Help & Support</a>
                <a href="privacy.html" class="footer-link">Privacy Policy</a>
                <a href="terms.html" class="footer-link">Terms of Service</a>
                <a href="#" class="footer-link" id="manage-subjects-link">Manage Subjects</a>
                <!-- Admin link only for admin -->
                <a href="admin.html" class="footer-link hidden" id="admin-link">Admin Panel</a>
            </div>
            <div class="footer-copyright">
                <p>Planora &copy; 2026. Made with <i class="fas fa-heart"></i> for students worldwide.</p>
                <p class="footer-credit">Created by <span class="author-name">Akansha Soni</span></p>
            </div>
        </div>
    </footer>

    <!-- Firebase Scripts -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, sendPasswordResetEmail } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getDatabase, ref, set, get, update, remove, onValue } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCLqhNiiOdYVAPUKKJyQkvs-JHGLCR0K74",
            authDomain: "planora-test-38d0d.firebaseapp.com",
            databaseURL: "https://planora-test-38d0d-default-rtdb.firebaseio.com",
            projectId: "planora-test-38d0d",
            storageBucket: "planora-test-38d0d.firebasestorage.app",
            messagingSenderId: "62845270738",
            appId: "1:62845270738:web:d19abd9e052c677ff80b0b"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const database = getDatabase(app);

        // Admin email (CHANGE THIS TO YOUR EMAIL)
        const ADMIN_EMAIL = "akanshas120608@gmail.com";

        // Make available globally
        window.auth = auth;
        window.database = database;
        window.dbRef = ref;
        window.dbSet = set;
        window.dbGet = get;
        window.dbUpdate = update;
        window.dbRemove = remove;
        window.dbOnValue = onValue;
        window.ADMIN_EMAIL = ADMIN_EMAIL;

        console.log("âœ… Firebase initialized successfully!");

        // Auth State Listener
        onAuthStateChanged(auth, (user) => {
            console.log("Auth state changed:", user ? user.email : "No user");
            
            if (user) {
                showUserInfo(user);
                loadUserData(user.uid);
                
                // Show admin link if user is admin
                if (user.email === ADMIN_EMAIL) {
                    document.getElementById('admin-link').classList.remove('hidden');
                }
            } else {
                showLoginPrompt();
                clearUserData();
                document.getElementById('admin-link').classList.add('hidden');
            }
        });

        function showUserInfo(user) {
            document.getElementById('login-prompt').classList.add('hidden');
            document.getElementById('user-info').classList.remove('hidden');
            document.getElementById('username').textContent = user.email.split('@')[0];
            closeAllModals();
        }

        function showLoginPrompt() {
            document.getElementById('user-info').classList.add('hidden');
            document.getElementById('login-prompt').classList.remove('hidden');
        }

        function closeAllModals() {
            document.querySelectorAll('.modal').forEach(modal => {
                modal.classList.remove('active');
            });
        }

        function showError(elementId, message) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="error-message">${message}</div>`;
            element.classList.remove('hidden');
            setTimeout(() => element.classList.add('hidden'), 5000);
        }

        function showSuccess(elementId, message) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="success-message">${message}</div>`;
            element.classList.remove('hidden');
            setTimeout(() => element.classList.add('hidden'), 3000);
        }

        function showLoading(buttonId, spinnerId, textId) {
            document.getElementById(spinnerId).classList.remove('hidden');
            document.getElementById(textId).textContent = 'Processing...';
            document.getElementById(buttonId).disabled = true;
        }

        function hideLoading(buttonId, spinnerId, textId, originalText) {
            document.getElementById(spinnerId).classList.add('hidden');
            document.getElementById(textId).textContent = originalText;
            document.getElementById(buttonId).disabled = false;
        }

        function loadUserData(userId) {
            console.log("Loading data for user:", userId);
            if (typeof window.loadUserTasks === 'function') {
                window.loadUserTasks(userId);
            }
        }

        function clearUserData() {
            console.log("Clearing user data");
            if (typeof window.clearTasks === 'function') {
                window.clearTasks();
            }
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', () => {
            // Login button
            document.getElementById('login-btn').addEventListener('click', () => {
                document.getElementById('login-modal').classList.add('active');
            });
            
            // Logout
            document.getElementById('logout-btn').addEventListener('click', () => {
                signOut(auth);
            });
            
            // Sign Up
            document.getElementById('signup-submit-btn').addEventListener('click', async () => {
                const email = document.getElementById('signup-email').value.trim();
                const password = document.getElementById('signup-password').value;
                const confirm = document.getElementById('signup-confirm').value;
                
                if (!email || !password || !confirm) {
                    showError('signup-error', 'Please fill in all fields');
                    return;
                }
                
                if (password.length < 6) {
                    showError('signup-error', 'Password must be at least 6 characters');
                    return;
                }
                
                if (password !== confirm) {
                    showError('signup-error', 'Passwords do not match');
                    return;
                }
                
                showLoading('signup-submit-btn', 'signup-spinner', 'signup-text');
                
                try {
                    const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                    await set(ref(database, 'users/' + userCredential.user.uid), {
                        email: email,
                        createdAt: new Date().toISOString(),
                        plan: 'free'
                    });
                } catch (error) {
                    let errorMessage = 'Sign up failed. ';
                    switch (error.code) {
                        case 'auth/email-already-in-use':
                            errorMessage += 'This email is already registered.';
                            break;
                        case 'auth/invalid-email':
                            errorMessage += 'Invalid email address.';
                            break;
                        default:
                            errorMessage += error.message;
                    }
                    showError('signup-error', errorMessage);
                } finally {
                    hideLoading('signup-submit-btn', 'signup-spinner', 'signup-text', 'Create Account');
                }
            });
            
            // Login
            document.getElementById('login-submit-btn').addEventListener('click', async () => {
                const email = document.getElementById('login-email').value.trim();
                const password = document.getElementById('login-password').value;
                
                if (!email || !password) {
                    showError('login-error', 'Please fill in all fields');
                    return;
                }
                
                showLoading('login-submit-btn', 'login-spinner', 'login-text');
                
                try {
                    await signInWithEmailAndPassword(auth, email, password);
                } catch (error) {
                    let errorMessage = 'Login failed. ';
                    switch (error.code) {
                        case 'auth/user-not-found':
                            errorMessage += 'No account found with this email.';
                            break;
                        case 'auth/wrong-password':
                        case 'auth/invalid-credential':
                            errorMessage += 'Incorrect password.';
                            break;
                        default:
                            errorMessage += error.message;
                    }
                    showError('login-error', errorMessage);
                } finally {
                    hideLoading('login-submit-btn', 'login-spinner', 'login-text', 'Login');
                }
            });
            
            // Forgot Password
            document.getElementById('forgot-submit-btn').addEventListener('click', async () => {
                const email = document.getElementById('forgot-email').value.trim();
                
                if (!email) {
                    showError('forgot-error', 'Please enter your email');
                    return;
                }
                
                showLoading('forgot-submit-btn', 'forgot-spinner', 'forgot-text');
                
                try {
                    await sendPasswordResetEmail(auth, email);
                    showSuccess('forgot-success', 'Password reset email sent! Check your inbox.');
                    document.getElementById('forgot-email').value = '';
                    setTimeout(() => {
                        document.getElementById('forgot-modal').classList.remove('active');
                    }, 3000);
                } catch (error) {
                    showError('forgot-error', error.message);
                } finally {
                    hideLoading('forgot-submit-btn', 'forgot-spinner', 'forgot-text', 'Send Reset Link');
                }
            });
            
            // Modal switching
            document.getElementById('switch-to-signup').addEventListener('click', (e) => {
                e.preventDefault();
                document.getElementById('login-modal').classList.remove('active');
                document.getElementById('signup-modal').classList.add('active');
            });
            
            document.getElementById('switch-to-login').addEventListener('click', (e) => {
                e.preventDefault();
                document.getElementById('signup-modal').classList.remove('active');
                document.getElementById('login-modal').classList.add('active');
            });
            
            document.getElementById('forgot-password').addEventListener('click', (e) => {
                e.preventDefault();
                document.getElementById('login-modal').classList.remove('active');
                document.getElementById('forgot-modal').classList.add('active');
            });
            
            document.getElementById('switch-to-login-from-forgot').addEventListener('click', (e) => {
                e.preventDefault();
                document.getElementById('forgot-modal').classList.remove('active');
                document.getElementById('login-modal').classList.add('active');
            });
            
            // Close modals
            document.querySelectorAll('.modal-close').forEach(btn => {
                btn.addEventListener('click', function() {
                    this.closest('.modal').classList.remove('active');
                });
            });
            
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        this.classList.remove('active');
                    }
                });
            });
            
            // Waitlist
            document.getElementById('waitlist-btn').addEventListener('click', () => {
                document.getElementById('waitlist-modal').classList.add('active');
            });
            
            document.getElementById('join-waitlist-btn').addEventListener('click', async () => {
                const email = document.getElementById('waitlist-email').value.trim();
                if (!email) {
                    alert('Please enter your email');
                    return;
                }
                
                try {
                    await set(ref(database, 'waitlist/' + Date.now()), {
                        email: email,
                        joinedAt: new Date().toISOString()
                    });
                    alert(`Thank you! We'll notify you at ${email} when Premium launches.`);
                    document.getElementById('waitlist-modal').classList.remove('active');
                    document.getElementById('waitlist-email').value = '';
                } catch (error) {
                    alert('Failed to join waitlist. Please try again.');
                }
            });
            
            // Manage Subjects
            document.getElementById('manage-subjects-link').addEventListener('click', (e) => {
                e.preventDefault();
                if (typeof window.openManageSubjects === 'function') {
                    window.openManageSubjects();
                }
            });
            
            // Dark Mode Toggle
            const themeToggle = document.getElementById('theme-toggle');
            const html = document.documentElement;
            
            // Check for saved theme preference or default to light mode
            const currentTheme = localStorage.getItem('theme') || 'light';
            html.setAttribute('data-theme', currentTheme);
            
            // Update icon based on current theme
            updateThemeIcon(currentTheme);
            
            themeToggle.addEventListener('click', () => {
                const currentTheme = html.getAttribute('data-theme');
                const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                
                html.setAttribute('data-theme', newTheme);
                localStorage.setItem('theme', newTheme);
                updateThemeIcon(newTheme);
            });
            
            function updateThemeIcon(theme) {
                const icon = themeToggle.querySelector('i');
                if (theme === 'dark') {
                    icon.classList.remove('fa-moon');
                    icon.classList.add('fa-sun');
                } else {
                    icon.classList.remove('fa-sun');
                    icon.classList.add('fa-moon');
                }
            }
            
            // Initialize app
            if (typeof initApp === 'function') {
                initApp();
            }
        });
    </script>

    <!-- App Logic -->
    <script src="app.js"></script>
</body>
</html>
