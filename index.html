<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planora - Your Smart Study Planner</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/x-icon" href="https://i.ibb.co/23kTbpHJ/Whats-App-Image-2025-12-31-at-01-34-54.jpg">
</head>
<body>
    <!-- Top Header with Logo -->
    <header class="main-header">
        <div class="header-content">
            <div class="logo-container">
                <img src="https://i.ibb.co/23kTbpHJ/Whats-App-Image-2025-12-31-at-01-34-54.jpg" alt="Planora Logo" class="logo">
                <h1 class="app-title">Planora</h1>
            </div>
            <div class="user-section">
                <div class="login-prompt" id="login-prompt">
                    <i class="fas fa-user"></i>
                    <span>Sign in to save your data</span>
                    <button class="login-btn" id="login-btn">Sign In</button>
                </div>
                <div class="user-info hidden" id="user-info">
                    <span id="username">User</span>
                    <button class="logout-btn" id="logout-btn">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Premium Banner (Coming Soon) -->
    <div class="premium-banner">
        <div class="banner-content">
            <i class="fas fa-crown"></i>
            <span><strong>Premium</strong> launching soon! Get unlimited subjects, cloud sync, and more.</span>
            <button class="waitlist-btn" id="waitlist-btn">Join Waitlist</button>
        </div>
    </div>

    <!-- Main App Container -->
    <div class="app-container">
        <!-- Month/Year Selector -->
        <div class="month-selector">
            <button class="nav-btn" id="prev-month">
                <i class="fas fa-chevron-left"></i>
            </button>
            <div class="month-display">
                <h2 id="current-month">December 2025</h2>
                <div class="date-range" id="date-range">Dec 01 - Dec 31</div>
            </div>
            <button class="nav-btn" id="next-month">
                <i class="fas fa-chevron-right"></i>
            </button>
        </div>

        <!-- Date Grid (Top Navigation) -->
        <div class="date-grid-container">
            <div class="date-grid" id="date-grid">
                <!-- Dates will be generated by JavaScript -->
            </div>
        </div>

        <!-- Days Container - Responsive Layout -->
        <div class="days-container" id="days-container">
            <!-- Days will be generated by JavaScript -->
            <!-- Desktop: Shows 3 days per row -->
            <!-- Mobile: Shows 1 day, will be swipeable -->
        </div>

        <!-- Mobile Swipe Instructions -->
        <div class="swipe-hint mobile-only">
            <i class="fas fa-arrows-alt-h"></i>
            <span>Swipe left/right to navigate days</span>
        </div>
    </div>

    <!-- Add Task Modal -->
    <div class="modal hidden" id="add-task-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add New Task</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="task-subject">Subject</label>
                    <select id="task-subject">
                        <option value="physics">Physics</option>
                        <option value="chemistry">Chemistry</option>
                        <option value="mathematics">Mathematics</option>
                        <option value="biology">Biology</option>
                        <option value="english">English</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="task-text">Task Description</label>
                    <input type="text" id="task-text" placeholder="Enter task description...">
                </div>
                <button class="btn-primary" id="save-task-btn">Add Task</button>
            </div>
        </div>
    </div>

    <!-- Add Subject Modal -->
    <div class="modal hidden" id="add-subject-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add New Subject</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="subject-name">Subject Name</label>
                    <input type="text" id="subject-name" placeholder="e.g., Computer Science">
                </div>
                <div class="form-group">
                    <label for="subject-color">Color</label>
                    <input type="color" id="subject-color" value="#4a6fa5">
                </div>
                <button class="btn-primary" id="save-subject-btn">Add Subject</button>
            </div>
        </div>
    </div>

    <!-- Waitlist Modal -->
    <div class="modal hidden" id="waitlist-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-crown"></i> Join Premium Waitlist</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <p>Be the first to know when Planora Premium launches! Get exclusive early access and a special discount.</p>
                <div class="premium-features">
                    <h4>Premium Features:</h4>
                    <ul>
                        <li><i class="fas fa-check"></i> Unlimited subjects & tasks</li>
                        <li><i class="fas fa-check"></i> Cloud backup & sync</li>
                        <li><i class="fas fa-check"></i> Dark mode & custom themes</li>
                        <li><i class="fas fa-check"></i> PDF export & analytics</li>
                        <li><i class="fas fa-check"></i> Priority support</li>
                    </ul>
                </div>
                <div class="form-group">
                    <label for="waitlist-email">Your Email</label>
                    <input type="email" id="waitlist-email" placeholder="you@example.com">
                </div>
                <button class="btn-primary" id="join-waitlist-btn">Join Waitlist</button>
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div class="modal hidden" id="login-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-sign-in-alt"></i> Login to Planora</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="login-email">Email</label>
                    <input type="email" id="login-email" placeholder="you@example.com">
                </div>
                <div class="form-group">
                    <label for="login-password">Password</label>
                    <input type="password" id="login-password" placeholder="Enter your password">
                </div>
                <div class="form-options">
                    <a href="#" class="forgot-password" id="forgot-password">Forgot password?</a>
                </div>
                <div id="login-error" class="hidden"></div>
                <button class="btn-primary" id="login-submit-btn">
                    <i class="fas fa-spinner fa-spin hidden" id="login-spinner"></i>
                    <span id="login-text">Login</span>
                </button>
                <div class="auth-switch">
                    <p>Don't have an account? <a href="#" id="switch-to-signup">Sign up</a></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Sign Up Modal -->
    <div class="modal hidden" id="signup-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-user-plus"></i> Create Account</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="signup-email">Email</label>
                    <input type="email" id="signup-email" placeholder="you@example.com">
                </div>
                <div class="form-group">
                    <label for="signup-password">Password</label>
                    <input type="password" id="signup-password" placeholder="Create a password (min. 6 characters)">
                </div>
                <div class="form-group">
                    <label for="signup-confirm">Confirm Password</label>
                    <input type="password" id="signup-confirm" placeholder="Confirm your password">
                </div>
                <div class="password-requirements">
                    <small>Password must be at least 6 characters long</small>
                </div>
                <div id="signup-error" class="hidden"></div>
                <button class="btn-primary" id="signup-submit-btn">
                    <i class="fas fa-spinner fa-spin hidden" id="signup-spinner"></i>
                    <span id="signup-text">Create Account</span>
                </button>
                <div class="auth-switch">
                    <p>Already have an account? <a href="#" id="switch-to-login">Login</a></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Forgot Password Modal -->
    <div class="modal hidden" id="forgot-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-key"></i> Reset Password</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <p>Enter your email address and we'll send you a link to reset your password.</p>
                <div class="form-group">
                    <label for="forgot-email">Email</label>
                    <input type="email" id="forgot-email" placeholder="you@example.com">
                </div>
                <div id="forgot-error" class="hidden"></div>
                <div id="forgot-success" class="hidden"></div>
                <button class="btn-primary" id="forgot-submit-btn">
                    <i class="fas fa-spinner fa-spin hidden" id="forgot-spinner"></i>
                    <span id="forgot-text">Send Reset Link</span>
                </button>
                <div class="auth-switch">
                    <p>Remember your password? <a href="#" id="switch-to-login-from-forgot">Login</a></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="main-footer">
        <div class="footer-content">
            <div class="footer-links">
                <a href="#" class="footer-link">Help & Support</a>
                <a href="#" class="footer-link">Privacy Policy</a>
                <a href="#" class="footer-link">Terms of Service</a>
                <a href="#" class="footer-link">Contact Us</a>
            </div>
            <div class="footer-copyright">
                <p>Planora &copy; 2025. Made with <i class="fas fa-heart"></i> for students worldwide.</p>
                <p class="footer-credit">Created by <span class="author-name">Akansha Soni</span></p>
            </div>
        </div>
    </footer>

    <!-- Firebase Scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>

    <!-- Firebase Configuration -->
    <script>
        // Firebase configuration
        const firebaseConfig = {
    apiKey: "AIzaSyDovLKo3djdRbs963vqKdbj-geRWyzMTrg",
    authDomain: "planora-86835.firebaseapp.com",
    databaseURL: "https://planora-86835-default-rtdb.firebaseio.com", // ← CHANGE THIS
    projectId: "planora-86835",
    storageBucket: "planora-86835.appspot.com",
    messagingSenderId: "971834924900",
    appId: "1:971834924900:web:ff3d82595e08839130e471"
};
        // ===== FORCE REFERER HEADER FIX =====
// This makes all Firebase requests appear to come from authorized domain
(function() {
    console.log("Applying referer header fix...");
    
    // Store original fetch
    const originalFetch = window.fetch;
    
    // Override fetch to add correct referer
    window.fetch = function(resource, options) {
        if (typeof resource === 'string' && resource.includes('identitytoolkit.googleapis.com')) {
            options = options || {};
            options.headers = options.headers || {};
            
            // Force referer to firebaseapp.com (authorized domain)
            options.headers['Referer'] = 'https://planora-86835.firebaseapp.com';
            options.headers['Origin'] = 'https://planora-86835.firebaseapp.com';
            
            console.log("Modified request with referer:", options.headers.Referer);
        }
        return originalFetch.call(this, resource, options);
    };
    
    // Also override XMLHttpRequest for Firebase SDK internal calls
    const originalXHROpen = XMLHttpRequest.prototype.open;
    XMLHttpRequest.prototype.open = function(method, url) {
        if (url.includes('identitytoolkit.googleapis.com')) {
            this._firebaseAuthUrl = true;
        }
        return originalXHROpen.apply(this, arguments);
    };
    
    const originalXHRSend = XMLHttpRequest.prototype.send;
    XMLHttpRequest.prototype.send = function(body) {
        if (this._firebaseAuthUrl) {
            this.setRequestHeader('Referer', 'https://planora-86835.firebaseapp.com');
            this.setRequestHeader('Origin', 'https://planora-86835.firebaseapp.com');
        }
        return originalXHRSend.call(this, body);
    };
    
    console.log("✅ Referer header fix applied");
})();
        // Initialize Firebase
        try {
            const app = firebase.initializeApp(firebaseConfig);
            window.auth = firebase.auth();
            window.db = firebase.database();
            console.log("✅ Firebase initialized successfully!");
        } catch (error) {
            console.error("❌ Firebase initialization error:", error);
        }
    </script>

  <!-- Authentication System - WORKING VERSION -->
<script>
    // ===== WORKING AUTHENTICATION SYSTEM =====
    
    // Global state
    let currentUser = null;
    
    // ===== DIRECT REST API AUTH (100% WORKS) =====
    async function signUpDirect(email, password, confirmPassword) {
        // Validation
        if (!email || !password || !confirmPassword) {
            throw new Error('Please fill in all fields');
        }
        if (password.length < 6) {
            throw new Error('Password must be at least 6 characters long');
        }
        if (password !== confirmPassword) {
            throw new Error('Passwords do not match');
        }
        if (!validateEmail(email)) {
            throw new Error('Please enter a valid email address');
        }
        
        try {
            // 1. Create user via REST API with forced headers
            const response = await fetch('https://identitytoolkit.googleapis.com/v1/accounts:signUp?key=' + firebaseConfig.apiKey, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Referer': 'https://planora-86835.firebaseapp.com',
                    'Origin': 'https://planora-86835.firebaseapp.com'
                },
                body: JSON.stringify({
                    email: email,
                    password: password,
                    returnSecureToken: true
                })
            });
            
            const data = await response.json();
            
            if (data.error) {
                throw new Error(data.error.message);
            }
            
            console.log("✅ User created via REST API:", data.email);
            
            // 2. Save user to database
            await db.ref('users/' + data.localId).set({
                email: email,
                createdAt: new Date().toISOString(),
                plan: 'free'
            });
            
            // 3. Sign in with custom token (optional)
            // For now, just update UI
            currentUser = {
                uid: data.localId,
                email: data.email,
                getIdToken: async () => data.idToken
            };
            
            showUserInfo(currentUser);
            return currentUser;
            
        } catch (error) {
            console.error("Sign up error:", error);
            throw error;
        }
    }
    
    async function loginDirect(email, password) {
        if (!email || !password) {
            throw new Error('Please fill in all fields');
        }
        if (!validateEmail(email)) {
            throw new Error('Please enter a valid email address');
        }
        
        try {
            const response = await fetch('https://identitytoolkit.googleapis.com/v1/accounts:signInWithPassword?key=' + firebaseConfig.apiKey, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Referer': 'https://planora-86835.firebaseapp.com',
                    'Origin': 'https://planora-86835.firebaseapp.com'
                },
                body: JSON.stringify({
                    email: email,
                    password: password,
                    returnSecureToken: true
                })
            });
            
            const data = await response.json();
            
            if (data.error) {
                throw new Error(data.error.message);
            }
            
            console.log("✅ User logged in:", data.email);
            
            currentUser = {
                uid: data.localId,
                email: data.email,
                getIdToken: async () => data.idToken
            };
            
            showUserInfo(currentUser);
            return currentUser;
            
        } catch (error) {
            console.error("Login error:", error);
            throw error;
        }
    }
    
    // ===== UI FUNCTIONS (same as before) =====
    function showUserInfo(user) {
        document.getElementById('login-prompt').classList.add('hidden');
        document.getElementById('user-info').classList.remove('hidden');
        document.getElementById('username').textContent = user.email.split('@')[0];
        closeAllModals();
    }
    
    function showLoginPrompt() {
        document.getElementById('user-info').classList.add('hidden');
        document.getElementById('login-prompt').classList.remove('hidden');
    }
    
    function closeAllModals() {
        document.querySelectorAll('.modal').forEach(modal => {
            modal.classList.remove('active');
        });
    }
    
    function showError(elementId, message) {
        const element = document.getElementById(elementId);
        element.innerHTML = `<div class="error-message">${message}</div>`;
        element.classList.remove('hidden');
        setTimeout(() => element.classList.add('hidden'), 5000);
    }
    
    function showSuccess(elementId, message) {
        const element = document.getElementById(elementId);
        element.innerHTML = `<div class="success-message">${message}</div>`;
        element.classList.remove('hidden');
        setTimeout(() => element.classList.add('hidden'), 3000);
    }
    
    function showLoading(buttonId, spinnerId, textId) {
        document.getElementById(spinnerId).classList.remove('hidden');
        document.getElementById(textId).textContent = 'Processing...';
        document.getElementById(buttonId).disabled = true;
    }
    
    function hideLoading(buttonId, spinnerId, textId, originalText) {
        document.getElementById(spinnerId).classList.add('hidden');
        document.getElementById(textId).textContent = originalText;
        document.getElementById(buttonId).disabled = false;
    }
    
    // ===== EVENT LISTENERS =====
    function setupAuthEventListeners() {
        console.log("Setting up DIRECT auth event listeners...");
        
        // Login button
        document.getElementById('login-btn').addEventListener('click', () => {
            document.getElementById('login-modal').classList.add('active');
        });
        
        // Logout button
        document.getElementById('logout-btn').addEventListener('click', () => {
            currentUser = null;
            showLoginPrompt();
            console.log("User logged out");
        });
        
        // Login form
        document.getElementById('login-submit-btn').addEventListener('click', async () => {
            const email = document.getElementById('login-email').value.trim();
            const password = document.getElementById('login-password').value;
            
            showLoading('login-submit-btn', 'login-spinner', 'login-text');
            
            try {
                await loginDirect(email, password);
            } catch (error) {
                showError('login-error', error.message);
            } finally {
                hideLoading('login-submit-btn', 'login-spinner', 'login-text', 'Login');
            }
        });
        
        // Sign up form
        document.getElementById('signup-submit-btn').addEventListener('click', async () => {
            const email = document.getElementById('signup-email').value.trim();
            const password = document.getElementById('signup-password').value;
            const confirmPassword = document.getElementById('signup-confirm').value;
            
            showLoading('signup-submit-btn', 'signup-spinner', 'signup-text');
            
            try {
                await signUpDirect(email, password, confirmPassword);
            } catch (error) {
                showError('signup-error', error.message);
            } finally {
                hideLoading('signup-submit-btn', 'signup-spinner', 'signup-text', 'Create Account');
            }
        });
        
        // Modal switching (keep existing)
        document.getElementById('switch-to-signup').addEventListener('click', (e) => {
            e.preventDefault();
            document.getElementById('login-modal').classList.remove('active');
            document.getElementById('signup-modal').classList.add('active');
        });
        
        document.getElementById('switch-to-login').addEventListener('click', (e) => {
            e.preventDefault();
            document.getElementById('signup-modal').classList.remove('active');
            document.getElementById('login-modal').classList.add('active');
        });
        
        // Close modals
        document.querySelectorAll('.modal-close').forEach(btn => {
            btn.addEventListener('click', function() {
                this.closest('.modal').classList.remove('active');
            });
        });
    }
    
    // ===== HELPER FUNCTIONS =====
    function validateEmail(email) {
        const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return re.test(email);
    }
    
    // ===== INITIALIZATION =====
    document.addEventListener('DOMContentLoaded', () => {
        console.log("DOM loaded, setting up DIRECT auth...");
        setupAuthEventListeners();
        
        // Check localStorage for existing session
        const savedUser = localStorage.getItem('planora_user');
        if (savedUser) {
            try {
                currentUser = JSON.parse(savedUser);
                showUserInfo(currentUser);
            } catch (e) {
                localStorage.removeItem('planora_user');
            }
        }
        
        // Initialize existing app if function exists
        if (typeof initApp === 'function') {
            initApp();
        }
    });
    
    console.log("✅ DIRECT Authentication system ready!");
</script>
    <!-- Your App Code -->
    <script src="app.js"></script>
</body>
</html>



